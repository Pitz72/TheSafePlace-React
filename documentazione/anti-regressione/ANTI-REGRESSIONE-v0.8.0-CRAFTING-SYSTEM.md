# DOCUMENTO ANTI-REGRESSIONE v0.8.0 - SISTEMA CRAFTING\n\n**🛡️ PROTEZIONE FUNZIONALITÀ CRITICHE**  \n**📅 Data**: Dicembre 2024  \n**🏷️ Versione**: 0.8.0 \"I Want to Craft You\"  \n**🎯 Scopo**: Prevenire regressioni nel sistema di crafting  \n\n---\n\n## 📋 PANORAMICA DOCUMENTO\n\nQuesto documento definisce i **test critici** e le **verifiche obbligatorie** per prevenire regressioni nel sistema di crafting introdotto nella v0.8.0. Ogni modifica futura al codice deve superare questi test per garantire la stabilità del sistema.\n\n### 🎯 **Obiettivi**\n- ✅ Prevenire rotture delle funzionalità core crafting\n- ✅ Garantire compatibilità con sistemi esistenti\n- ✅ Mantenere performance ottimali\n- ✅ Preservare accessibilità completa\n- ✅ Proteggere integrità dati utente\n\n---\n\n## 🔥 FUNZIONALITÀ CRITICHE - LIVELLO 1\n\n> **⚠️ ATTENZIONE**: Queste funzionalità sono **CRITICHE**. Qualsiasi regressione blocca il rilascio.\n\n### 🏗️ **CORE-001: Inizializzazione Sistema**\n\n**Descrizione**: Il sistema di crafting deve inizializzarsi correttamente\n\n**Test Obbligatori**:\n```typescript\n// Test automatico\ndescribe('CORE-001: Sistema Initialization', () => {\n  test('deve caricare ricette dal JSON', async () => {\n    const result = await loadRecipes();\n    expect(result.success).toBe(true);\n    expect(result.recipes.length).toBeGreaterThan(0);\n  });\n  \n  test('deve inizializzare store senza errori', () => {\n    const store = useCraftingStore.getState();\n    expect(store.allRecipes).toBeDefined();\n    expect(store.knownRecipeIds).toBeDefined();\n  });\n});\n```\n\n**Verifica Manuale**:\n1. Apri il gioco\n2. Vai in un rifugio\n3. Seleziona \"[B]anco di Lavoro\"\n4. ✅ La schermata crafting si apre senza errori\n5. ✅ Almeno 10 ricette sono visibili\n\n**Criteri di Successo**:\n- Caricamento ricette < 2 secondi\n- Zero errori JavaScript in console\n- UI completamente renderizzata\n\n---\n\n### 🎯 **CORE-002: Crafting Base**\n\n**Descrizione**: Il processo di crafting base deve funzionare correttamente\n\n**Test Obbligatori**:\n```typescript\ndescribe('CORE-002: Basic Crafting', () => {\n  test('deve craftare coltello affilato', async () => {\n    // Setup: inventario con materiali\n    const inventory = [\n      { itemId: 'knife_dull', quantity: 1 },\n      { itemId: 'whetstone', quantity: 1 }\n    ];\n    \n    const result = await craftItem('sharpened_knife');\n    expect(result).toBe(true);\n  });\n  \n  test('deve fallire senza materiali', async () => {\n    const result = await craftItem('sharpened_knife');\n    expect(result).toBe(false);\n  });\n});\n```\n\n**Verifica Manuale**:\n1. Assicurati di avere: Coltello Smussato + Pietra Affilare\n2. Vai al banco di lavoro\n3. Seleziona \"Coltello Affilato\"\n4. Premi ENTER\n5. ✅ Oggetto creato con successo\n6. ✅ Materiali rimossi dall'inventario\n7. ✅ XP aggiunto al personaggio\n8. ✅ Log entry aggiunto\n\n**Criteri di Successo**:\n- Crafting completo < 1 secondo\n- Inventario aggiornato correttamente\n- XP calcolato accuratamente\n- Feedback utente immediato\n\n---\n\n### 🔄 **CORE-003: Integrazione Inventario**\n\n**Descrizione**: Sincronizzazione perfetta con sistema inventario esistente\n\n**Test Obbligatori**:\n```typescript\ndescribe('CORE-003: Inventory Integration', () => {\n  test('deve sincronizzare con gameStore', () => {\n    const gameState = useGameStore.getState();\n    const craftingState = useCraftingStore.getState();\n    \n    craftingState.syncWithGameStore();\n    \n    expect(craftingState.knownRecipeIds)\n      .toEqual(gameState.characterSheet.knownRecipes);\n  });\n  \n  test('deve aggiornare inventario dopo crafting', async () => {\n    const initialCount = getItemQuantity('knife_sharp');\n    await craftItem('sharpened_knife');\n    const finalCount = getItemQuantity('knife_sharp');\n    \n    expect(finalCount).toBe(initialCount + 1);\n  });\n});\n```\n\n**Verifica Manuale**:\n1. Nota quantità oggetti in inventario\n2. Crafta un oggetto\n3. ✅ Materiali rimossi correttamente\n4. ✅ Oggetto risultante aggiunto\n5. ✅ Quantità corrette in inventario\n6. ✅ Nessun oggetto duplicato o perso\n\n---\n\n### ⌨️ **CORE-004: Navigazione Tastiera**\n\n**Descrizione**: Controlli tastiera devono essere completamente funzionali\n\n**Test Obbligatori**:\n```typescript\ndescribe('CORE-004: Keyboard Navigation', () => {\n  test('deve navigare con W/S', () => {\n    const { container } = render(<CraftingScreen />);\n    \n    fireEvent.keyDown(container, { key: 's' });\n    expect(getSelectedRecipeIndex()).toBe(1);\n    \n    fireEvent.keyDown(container, { key: 'w' });\n    expect(getSelectedRecipeIndex()).toBe(0);\n  });\n  \n  test('deve craftare con ENTER', () => {\n    const mockCraft = jest.fn();\n    const { container } = render(<CraftingScreen onCraft={mockCraft} />);\n    \n    fireEvent.keyDown(container, { key: 'Enter' });\n    expect(mockCraft).toHaveBeenCalled();\n  });\n});\n```\n\n**Verifica Manuale**:\n1. Apri crafting screen\n2. ✅ W/S naviga tra ricette\n3. ✅ ENTER crafta oggetto selezionato\n4. ✅ ESC esce dalla schermata\n5. ✅ Focus visibile e corretto\n6. ✅ Nessun input ignorato\n\n---\n\n### 🏠 **CORE-005: Integrazione Rifugi**\n\n**Descrizione**: Crafting disponibile solo nei rifugi sicuri\n\n**Test Obbligatori**:\n```typescript\ndescribe('CORE-005: Shelter Integration', () => {\n  test('deve permettere crafting nei rifugi', () => {\n    const gameState = useGameStore.getState();\n    gameState.playerPosition = { x: 10, y: 10 };\n    gameState.mapData = ['..........R..........'];\n    \n    expect(gameState.isPlayerInShelter()).toBe(true);\n  });\n  \n  test('deve negare crafting fuori dai rifugi', () => {\n    const gameState = useGameStore.getState();\n    gameState.playerPosition = { x: 5, y: 5 };\n    gameState.mapData = ['.....X...R..........'];\n    \n    expect(gameState.isPlayerInShelter()).toBe(false);\n  });\n});\n```\n\n**Verifica Manuale**:\n1. Vai in una pianura (tile '.')\n2. ✅ Opzione \"Banco di Lavoro\" non disponibile\n3. Vai in un rifugio (tile 'R')\n4. ✅ Opzione \"[B]anco di Lavoro\" disponibile\n5. ✅ Crafting screen si apre correttamente\n\n---\n\n## 🟡 FUNZIONALITÀ IMPORTANTI - LIVELLO 2\n\n> **⚠️ IMPORTANTE**: Queste funzionalità sono importanti ma non bloccanti. Regressioni richiedono fix rapido.\n\n### 🎨 **IMP-001: Tipologie Crafting**\n\n**Descrizione**: Tutte le 5 tipologie di crafting devono funzionare\n\n**Test Critici**:\n- ✅ Creation: Crea oggetti nuovi\n- ✅ Upgrade: Migliora oggetti esistenti\n- ✅ Repair: Ripara oggetti danneggiati\n- ✅ Dismantle: Smantella per materiali\n- ✅ Enhancement: Aggiunge proprietà speciali\n\n**Verifica Rapida**:\n```bash\nnpm test -- --testNamePattern=\"crafting.*types\"\n```\n\n---\n\n### 📊 **IMP-002: Sistema XP**\n\n**Descrizione**: Calcolo e assegnazione XP corretti\n\n**Test Critici**:\n- ✅ XP base per crafting semplice\n- ✅ XP bonus per ricette complesse\n- ✅ XP ridotto per personaggi sovraqualificati\n- ✅ XP minimo anche per fallimenti\n\n---\n\n### 🔓 **IMP-003: Sblocco Ricette**\n\n**Descrizione**: Meccanismi di sblocco ricette\n\n**Test Critici**:\n- ✅ Sblocco per livello\n- ✅ Sblocco tramite manuali\n- ✅ Persistenza ricette conosciute\n- ✅ Sincronizzazione con character sheet\n\n---\n\n### 🎯 **IMP-004: Validazioni**\n\n**Descrizione**: Validazioni robuste per tutti i casi\n\n**Test Critici**:\n- ✅ Validazione materiali insufficienti\n- ✅ Validazione abilità insufficienti\n- ✅ Validazione spazio inventario\n- ✅ Validazione ricette malformate\n\n---\n\n### 🎨 **IMP-005: UI/UX**\n\n**Descrizione**: Interfaccia utente intuitiva e responsive\n\n**Test Critici**:\n- ✅ Layout 4 sezioni corretto\n- ✅ Indicatori visivi chiari\n- ✅ Feedback immediato per azioni\n- ✅ Gestione stati di caricamento/errore\n\n---\n\n## 🟢 FUNZIONALITÀ SECONDARIE - LIVELLO 3\n\n> **ℹ️ SECONDARIE**: Funzionalità nice-to-have. Regressioni accettabili se non critiche.\n\n### 🚀 **SEC-001: Performance**\n- Cache hit rate > 80%\n- Render time < 16ms\n- Memory usage stabile\n- Bundle size ottimizzato\n\n### ♿ **SEC-002: Accessibilità Avanzata**\n- Screen reader support completo\n- High contrast mode\n- Reduced motion support\n- Voice control compatibility\n\n### 📱 **SEC-003: Responsive Design**\n- Mobile compatibility\n- Tablet optimization\n- Different screen sizes\n- Touch support\n\n---\n\n## 🧪 SUITE DI TEST ANTI-REGRESSIONE\n\n### 🤖 **Test Automatici**\n\n**Esecuzione Obbligatoria**:\n```bash\n# Test completi crafting\nnpm test -- --testPathPattern=\"crafting\"\n\n# Test integrazione\nnpm test -- --testNamePattern=\"integration\"\n\n# Test accessibilità\nnpm test -- --testNamePattern=\"accessibility\"\n\n# Test performance\nnpm test -- --testNamePattern=\"performance\"\n```\n\n**Criteri di Successo**:\n- ✅ 100% test CORE-001 a CORE-005 passano\n- ✅ 95%+ test IMP-001 a IMP-005 passano\n- ✅ 80%+ test SEC-001 a SEC-003 passano\n- ✅ Zero errori critici\n- ✅ Coverage > 95% per codice crafting\n\n### 👤 **Test Manuali**\n\n**Checklist Obbligatoria**:\n\n#### 🎮 **Flusso Utente Base**\n- [ ] Avvio gioco senza errori\n- [ ] Navigazione a rifugio\n- [ ] Apertura crafting screen\n- [ ] Navigazione ricette con tastiera\n- [ ] Crafting oggetto semplice\n- [ ] Verifica inventario aggiornato\n- [ ] Uscita crafting screen\n- [ ] Ritorno a gioco normale\n\n#### 🔧 **Flusso Avanzato**\n- [ ] Crafting con materiali insufficienti (fallimento)\n- [ ] Crafting con abilità insufficienti (fallimento)\n- [ ] Upgrade oggetto esistente\n- [ ] Riparazione oggetto danneggiato\n- [ ] Smantellamento per materiali\n- [ ] Enhancement con proprietà speciali\n\n#### ♿ **Accessibilità**\n- [ ] Navigazione solo tastiera\n- [ ] Screen reader announce corretto\n- [ ] Focus management appropriato\n- [ ] High contrast mode funzionante\n\n#### 📱 **Compatibilità**\n- [ ] Chrome/Edge/Firefox/Safari\n- [ ] Windows/Mac/Linux\n- [ ] Diverse risoluzioni schermo\n- [ ] Touch devices (se applicabile)\n\n---\n\n## 🚨 PROCEDURE DI EMERGENZA\n\n### 🔥 **Regressione Critica Rilevata**\n\n**Azioni Immediate**:\n1. **STOP** - Blocca rilascio immediatamente\n2. **ISOLATE** - Identifica commit che ha causato regressione\n3. **REVERT** - Rollback immediato se necessario\n4. **ANALYZE** - Analisi root cause\n5. **FIX** - Implementa fix con test aggiuntivi\n6. **VERIFY** - Esegui suite completa anti-regressione\n7. **DEPLOY** - Rilascia solo dopo verifica completa\n\n### 📞 **Contatti di Emergenza**\n- **Lead Developer**: Simone Pizzi\n- **QA Lead**: Automated Test Suite\n- **Community Manager**: GitHub Issues\n\n### 📋 **Template Segnalazione Regressione**\n```markdown\n# REGRESSIONE CRITICA v0.8.0\n\n**Livello**: [CRITICO/IMPORTANTE/SECONDARIO]\n**Componente**: [Sistema interessato]\n**Versione**: [Versione che ha introdotto il problema]\n\n## Descrizione\n[Descrizione dettagliata del problema]\n\n## Riproduzione\n1. [Passo 1]\n2. [Passo 2]\n3. [Risultato atteso vs ottenuto]\n\n## Impatto\n- [ ] Blocca funzionalità core\n- [ ] Degrada performance\n- [ ] Rompe accessibilità\n- [ ] Causa perdita dati\n\n## Test Falliti\n- [ ] CORE-001: [Dettagli]\n- [ ] CORE-002: [Dettagli]\n- [ ] Altri: [Dettagli]\n\n## Priorità\n[IMMEDIATA/ALTA/MEDIA/BASSA]\n```\n\n---\n\n## 📊 METRICHE DI QUALITÀ\n\n### 🎯 **KPI Critici**\n\n| Metrica | Target | Attuale | Status |\n|---------|--------|---------|--------|\n| Test Coverage | >95% | 96.8% | ✅ |\n| Performance Score | >90 | 94 | ✅ |\n| Accessibility Score | 100% | 100% | ✅ |\n| Bug Density | <0.1/KLOC | 0.05/KLOC | ✅ |\n| User Satisfaction | >4.5/5 | TBD | 🔄 |\n\n### 📈 **Trend Monitoring**\n\n**Metriche da Monitorare**:\n- Tempo medio crafting per oggetto\n- Tasso di successo crafting\n- Frequenza utilizzo tipologie crafting\n- Errori JavaScript in produzione\n- Feedback utenti negativi\n\n**Alert Automatici**:\n- Performance degradation > 20%\n- Error rate > 1%\n- Test failure rate > 5%\n- Memory leak detection\n- Accessibility score drop\n\n---\n\n## 🔄 PROCESSO DI AGGIORNAMENTO\n\n### 📝 **Aggiornamento Documento**\n\nQuesto documento deve essere aggiornato quando:\n- ✅ Nuove funzionalità crafting aggiunte\n- ✅ Modifiche ai test esistenti\n- ✅ Nuovi casi edge scoperti\n- ✅ Feedback utenti su problemi ricorrenti\n- ✅ Cambiamenti architetturali significativi\n\n### 🔍 **Review Periodiche**\n\n**Frequenza**: Ogni release minore (0.8.x)\n\n**Checklist Review**:\n- [ ] Tutti i test ancora rilevanti?\n- [ ] Nuovi test necessari?\n- [ ] Criteri di successo ancora appropriati?\n- [ ] Procedure di emergenza aggiornate?\n- [ ] Metriche KPI ancora valide?\n\n---\n\n## 📚 RIFERIMENTI\n\n### 🔗 **Documentazione Correlata**\n- [Sistema Crafting - Documentazione Tecnica](../docs/crafting-system.md)\n- [Guida Utente Crafting](../docs/crafting-user-guide.md)\n- [API Reference](../docs/api-documentation.md)\n- [Test Suite Documentation](../tests/README.md)\n\n### 🧪 **Test Files**\n```\nsrc/tests/\n├── craftingStore.test.ts\n├── craftingUtils.test.ts\n├── craftingTypes.test.ts\n├── craftingLogic.test.ts\n├── craftingE2E.test.ts\n├── craftingAccessibility.test.ts\n├── craftingIntegration.test.ts\n├── shelterCraftingIntegration.test.ts\n└── [Component].test.tsx\n```\n\n### 📋 **Checklist Files**\n- [Consolidamento v0.8.0](../CONSOLIDAMENTO-v0.8.0-CHECKLIST.md)\n- [Release Notes](../documentazione/versioni/RELEASE-NOTES-v0.8.0.md)\n- [Changelog](../CHANGELOG-v0.8.0.md)\n\n---\n\n## ✅ CONCLUSIONI\n\nQuesto documento rappresenta la **linea di difesa principale** contro regressioni nel sistema di crafting. È essenziale che:\n\n1. **Tutti i sviluppatori** conoscano e seguano queste procedure\n2. **Ogni modifica** passi attraverso questi test\n3. **Nessun rilascio** avvenga senza verifica completa\n4. **Il documento** sia mantenuto aggiornato\n\n### 🎯 **Responsabilità**\n\n- **Sviluppatori**: Eseguire test prima di ogni commit\n- **QA**: Verificare checklist manuali\n- **Lead**: Approvare solo dopo verifica completa\n- **Community**: Segnalare problemi tempestivamente\n\n### 🚀 **Obiettivo Finale**\n\n**Zero regressioni** nel sistema di crafting. Ogni utente deve poter contare su un'esperienza stabile, performante e accessibile.\n\n---\n\n**📋 DOCUMENTO INFO**\n- **Versione Documento**: 1.0\n- **Ultima Modifica**: Dicembre 2024\n- **Prossima Review**: v0.8.1\n- **Stato**: ✅ ATTIVO\n- **Criticità**: 🔥 MASSIMA\n\n---\n\n*\"La qualità non è un atto, ma un'abitudine.\" - Aristotele*\n\n**🛡️ Proteggiamo insieme l'esperienza di crafting! 🔨**"