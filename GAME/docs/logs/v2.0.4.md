# v2.0.4 - The "Brain Fix" & Stability Release

**Data:** 2025-12-04
**Autore:** Antigravity (Google Deepmind)
**Stato:** STABILE

## üéØ Obiettivo Principale
Risoluzione definitiva delle criticit√† di integrazione tra il nuovo stack narrativo (Inkjs) e la logica di gioco legacy (React/Zustand), con focus sulla stabilit√† e pulizia del codice.

## üõ†Ô∏è Modifiche Critiche (The "Brain Fix")

### 1. Sincronizzazione Narrativa-Gioco (FIX CRITICO)
*   **Problema:** Il gioco aveva "due cervelli". Ink gestiva i dialoghi, ma il sistema di gioco (QuestService) non sapeva quando una quest veniva avviata o completata da Ink, rendendo impossibili i trigger basati su eventi (es. "Trova oggetto X").
*   **Soluzione:** Riattivato il "ponte" in `NarrativeService.ts`. Ora, quando Ink esegue `startQuest` o `completeQuest`, chiama esplicitamente `questService`, garantendo che lo stato del gioco sia sempre sincronizzato.

### 2. UI Consistency
*   **QuestScreen:** Rifattorizzato per leggere le quest attive direttamente dal `CharacterStore` (la fonte di verit√† unificata). Ora tutte le quest, sia quelle avviate dalla trama principale che quelle secondarie, sono visibili nel diario.
*   **SaveLoadScreen:** Pulizia del codice e rimozione di variabili inutilizzate.

### 3. Type Safety & Bug Fixes
*   **MainScene.ts:** Risolto un errore di TypeScript bloccante nella generazione della Tilemap (`string[][]` vs `number[][]`). Aggiunto casting esplicito per garantire la compatibilit√† con Phaser.
*   **App.tsx:** Rimozione massiccia di "codice morto". I vecchi database non utilizzati (es. `DialogueDatabase`) non vengono pi√π caricati, migliorando le performance di avvio e riducendo i warning.

## üìÇ Riorganizzazione Documentazione
*   Tutta la documentazione √® stata unificata nella cartella `docs/`.
*   I log di versione sono ora in `docs/logs/`.
*   La roadmap √® stata spostata in `docs/ROADMAP.md`.

## üìù Note per lo Sviluppo Futuro
Il sistema √® ora stabile e integrato.
*   **Narrativa:** Usa Ink per scrivere storie e dialoghi.
*   **Logica:** Il `questService` risponder√† correttamente ai comandi di Ink.
*   **Grafica:** Phaser √® pronto per essere spinto al massimo senza errori di tipo.

---
*Versione stabile pronta per la produzione di nuovi contenuti.*
