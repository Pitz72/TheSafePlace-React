# Log di Sviluppo - Versione 1.9.7.2 "The Decoupling"

**Data Rilascio:** 08 Novembre 2025
**Tipo Release:** Patch
**Tempo Sviluppo:** 3 ore

---

## üéØ Overview

Questa release √® un hotfix critico per risolvere i problemi di deployment emersi dopo la separazione del progetto in due entit√†: il Sito Web (landing page) e il Gioco. L'obiettivo √® stato quello di ristrutturare la configurazione e il codice per permettere al gioco di funzionare correttamente quando ospitato in una sottocartella (`/game` o `/gioco`) di un dominio principale, invece che nella root.

### Obiettivi Principali

1. [x] Separare il deployment del Sito e del Gioco.
2. [x] Configurare il Gioco per essere eseguito da una sottocartella.
3. [x] Correggere tutti i percorsi di caricamento delle risorse (dati, JSON) per renderli relativi.

---

## üîç Il Problema / Motivazione

Dopo aver deciso di usare il dominio `thesafeplace.runtimeradio.it` per una landing page (progetto `SITO`) e di spostare il gioco in una sottocartella, sono emersi due problemi critici:

1.  **Asset Principali Non Trovati:** La configurazione iniziale del gioco (`base: '/'`) non permetteva a Vite di generare percorsi corretti per i file Javascript e CSS, risultando in una pagina bianca e errori 404.
2.  **Dati di Gioco Non Caricati:** Una volta risolto il primo problema, il gioco si avviava ma si bloccava al menu principale perch√© il codice interno tentava di caricare i file di dati (items, quests, events, etc.) usando percorsi assoluti (`/data/...`), fallendo miseramente.

### Impatto Pre-Fix

- ‚ùå Il gioco era completamente non avviabile se non posizionato nella root di un dominio.
- ‚ùå Cliccando "Nuova Partita" il gioco crashava a causa del fallimento nel caricamento di tutte le risorse di gioco.
- ‚ùå L'architettura di deployment desiderata (Sito in root, Gioco in sottocartella) era impossibile da realizzare.

---

## ‚úÖ La Soluzione Implementata

### 1. Riconfigurazione del Deployment

#### Descrizione
√à stata modificata la configurazione di build di entrambi i progetti per supportare la nuova architettura.

#### Dettagli Tecnici
- **Progetto `GAME` (`vite.config.ts`):**
  - Il parametro `base` √® stato cambiato da `'/game/'` a `'./'`. Questa modifica rende la build del gioco agnostica rispetto al percorso, generando percorsi relativi per gli asset principali. Questo ha risolto il problema della pagina bianca.

- **Progetto `SITO` (`App.tsx`, `Header.tsx`):**
  - I link che puntano al gioco sono stati standardizzati a `/game/` per coerenza.

### 2. Correzione Caricamento Dati (Path Rework)

#### Descrizione
Il problema pi√π profondo era che il codice sorgente del gioco utilizzava percorsi assoluti per le chiamate `fetch` ai file JSON. √à stato necessario ispezionare e correggere ogni singolo file di database.

#### Dettagli Tecnici
In tutti i file `...Database.ts` all'interno della cartella `GAME/data`, il pattern di caricamento √® stato modificato.

**Codice prima del fix:**
```typescript
// Esempio da itemDatabase.ts
const files = [
    '/data/items/weapons.json',
    // ...
];
const response = await fetch('/data/recipes.json');
```

**Codice dopo il fix:**
```typescript
// Esempio corretto
const files = [
    'data/items/weapons.json',
    // ...
];
const response = await fetch('data/recipes.json');
```
Questa modifica, applicata a 10 file di database, ha rimosso lo slash iniziale, rendendo tutti i percorsi relativi alla posizione del file `index.html` del gioco.

---

## üéÆ Impatto sul Gameplay

### Prima della v1.9.7.2
- ‚ùå Il gioco funzionava solo nella root di un dominio.
- ‚ùå Impossibile avviare una nuova partita in un ambiente di produzione su sottocartella.

### Dopo la v1.9.7.2
- ‚úÖ Il gioco pu√≤ essere deployato e funziona correttamente in qualsiasi sottocartella.
- ‚úÖ Tutti i dati di gioco (oggetti, quest, eventi, dialoghi, etc.) vengono caricati con successo.
- ‚úÖ L'architettura Sito + Gioco √® ora stabile e funzionante.

### Risultato
La release ripristina la piena funzionalit√† del gioco in un ambiente di produzione flessibile, risolvendo un blocco critico e permettendo la coesistenza con il sito web sullo stesso dominio.

---

## üìù File Modificati

### Game Logic (Data Loading)
- `data/itemDatabase.ts` - Corretto percorso di fetch.
- `data/eventDatabase.ts` - Corretto percorso di fetch.
- `data/cutsceneDatabase.ts` - Corretto percorso di fetch.
- `data/enemyDatabase.ts` - Corretto percorso di fetch.
- `data/loreArchiveDatabase.ts` - Corretto percorso di fetch.
- `data/mainStoryDatabase.ts` - Corretto percorso di fetch.
- `data/questDatabase.ts` - Corretto percorso di fetch.
- `data/recipeDatabase.ts` - Corretto percorso di fetch.
- `data/talentDatabase.ts` - Corretto percorso di fetch.
- `data/traderDatabase.ts` - Corretto percorso di fetch.
- `data/trophyDatabase.ts` - Corretto percorso di fetch.
- `data/dialogueDatabase.ts` - Corretto percorso di fetch.

### Build Configuration
- `GAME/vite.config.ts` - Modificato `base` in `'./'`.
- `SITO/index.html` - Aggiunti meta-tag anti-cache per troubleshooting.

### UI Components
- `SITO/components/Header.tsx` - Corretto link al gioco.

### Documentation
- `log/v1.9.7.2.md` - Questo changelog.

**Totale File Modificati:** 16

---

## üß™ Testing e Validazione

### Checklist Pre-Release
- [x] Build production (`GAME` e `SITO`) completata senza errori.
- [x] Test di caricamento in ambiente di produzione (su `thesafeplace.runtimeradio.it/gioco`) superato.
- [x] Avvio "Nuova Partita" funzionante senza errori in console.

---

## üéØ Conclusione

Questa patch, sebbene non introduca nuove feature, √® stata fondamentale per l'infrastruttura del progetto. Ha risolto un debito tecnico significativo legato al modo in cui il gioco gestisce i percorsi dei file, disaccoppiandolo dalla necessit√† di essere eseguito nella root di un dominio e aprendo la strada a un deployment stabile e flessibile.

**In Sintesi:**
- ‚úÖ Risolto il crash all'avvio di una nuova partita.
- ‚úÖ Il gioco ora funziona correttamente in una sottocartella.
- ‚úÖ L'architettura di deployment con sito e gioco √® stata stabilizzata.

---

*"A volte, per andare avanti, devi prima assicurarti di sapere esattamente dove sei."*

**- The Safe Place Chronicles Dev Team**
**Novembre 2025**
