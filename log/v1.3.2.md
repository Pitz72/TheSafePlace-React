# Log di Sviluppo - Versione 1.3.2 "The Medical Overhaul"

Questa versione risolve un problema critico di game design identificato durante l'analisi approfondita del sistema di status e oggetti curativi. Il sistema di sopravvivenza introduceva stati negativi che non potevano essere curati, trasformando il gameplay da sfidante a ingiustamente punitivo. La v1.3.2 sistema questo squilibrio, garantendo che ogni stato negativo abbia una contromisura accessibile al giocatore.

### Il Problema Identificato

#### Squilibrio nel Sistema di Cure

Il gioco implementava otto stati negativi (FERITO, MALATO, AVVELENATO, IPOTERMIA, ESAUSTO, AFFAMATO, DISIDRATATO, INFEZIONE), ma la disponibilità delle cure era fortemente sbilanciata:

- **Status AVVELENATO:** L'Antidoto esisteva come oggetto ma non compariva MAI negli eventi. L'unica via per ottenerlo era craftarlo tramite la ricetta "Antidoto Naturale", ma i materiali necessari erano estremamente rari.
- **Status MALATO:** Gli Antibiotici comparivano solo in 2 eventi su 88+ totali, sempre nella versione scaduta. Nessuna ricetta permetteva di crearli.
- **Status INFEZIONE:** Non esisteva NESSUN oggetto curativo per questo stato. L'INFEZIONE era una condanna a morte lenta senza alcuna contromisura disponibile.
- **Status FERITO:** Le Bende erano ben bilanciate, con buona disponibilità negli eventi e possibilità di craftarle.

### Dettagli dell'Implementazione

#### 1. Nuovi Oggetti Curativi

Sono stati aggiunti due nuovi oggetti al database dei consumabili:

- **Antibiotici (MED_ANTIBIOTICS):**
  - Tipo: Consumabile, Rarità: Uncommon
  - Effetti: Cura MALATO + 15 HP
  - Valore: 40, Peso: 0.1
  - Descrizione aggiornata per chiarezza

- **Erbe Curative (MED_HEALING_HERBS):**
  - Tipo: Consumabile, Rarità: Uncommon
  - Effetti: Cura INFEZIONE + 10 HP
  - Valore: 30, Peso: 0.1
  - Descrizione esplicita: "Efficaci contro infezioni e ferite infette"

#### 2. Nuove Ricette di Crafting

Sono state implementate 2 nuove ricette per permettere ai giocatori di creare cure in modo strategico:

- **Ricetta Antibiotici:**
  - Skill: Medicina, DC: 16, Tempo: 40 minuti
  - Ingredienti: 2x Antibiotici Scaduti, 1x Sostanze Chimiche di Base, 1x Disinfettante
  - Risultato: 1x Antibiotici
  - Concetto: Stabilizzare farmaci scaduti con reagenti chimici

- **Ricetta Erbe Curative:**
  - Skill: Medicina, DC: 12, Tempo: 20 minuti
  - Ingredienti: 2x Funghi Commestibili, 1x Bacche Selvatiche
  - Risultato: 2x Erbe Curative
  - Concetto: Preparare un rimedio antisettico naturale

#### 3. Distribuzione nelle Ricompense Eventi

Gli oggetti curativi sono stati aggiunti strategicamente in eventi tematicamente coerenti:

**Eventi Città:**
- **Farmacia Saccheggiata (city_broken_pharmacy):**
  - Opzione scaffali: ora droppa Antibiotici (non scaduti) invece di scaduti
  - NUOVA opzione "Esamina il frigorifero farmaceutico": 2x Antidoti + 1x Antibiotici (skill Medicina DC 13)

- **Ospedale Abbandonato (city_abandoned_hospital) - NUOVO EVENTO:**
  - Ambulatorio pronto soccorso: 1x Antidoto + 1x Antibiotici + 1x Kit Pronto Soccorso
  - Deposito farmaceutico: 2x Antidoti + 2x Antibiotici + 2x Antidolorifici (skill Medicina DC 14)
  - Evento ripetibile per garantire accesso continuativo

**Eventi Foresta:**
- **Rifugio dell'Eremita (forest_hermit_shelter):**
  - NUOVA opzione "Cerca nell'orto dell'eremita": 3x Erbe Curative + 2x Funghi Commestibili (skill Sopravvivenza DC 11)

**Eventi Villaggio:**
- **Clinica del Medico (village_doctor_clinic):**
  - Armadietto farmaci migliorato: ora include 1x Antibiotici + 1x Kit Pronto Soccorso
  - NUOVA opzione "Cerca nel giardino delle erbe medicinali": 2x Erbe Curative + 1x Funghi Commestibili (skill Sopravvivenza DC 10)

#### 4. Miglioramenti alla Chiarezza

Le descrizioni degli oggetti sono state riviste per comunicare chiaramente quale status curano:

- **Benda:** "Bende pulite per medicare ferite leggere." (cura FERITO)
- **Antibiotici:** "Antibiotici efficaci per curare malattie batteriche. Essenziali per sopravvivere alle infezioni." (cura MALATO)
- **Antidoto:** "Una siringa contenente un siero universale per neutralizzare i veleni comuni." (cura AVVELENATO)
- **Erbe Curative:** "Un mazzetto di erbe medicinali. Efficaci contro infezioni e ferite infette." (cura INFEZIONE)

### Bilanciamento e Disponibilità

La disponibilità delle cure è ora distribuita secondo questa logica:

- **Comune:** Bende (crafting facile + molti eventi)
- **Accessibile:** Erbe Curative (crafting medio + eventi foresta/villaggio)
- **Intermedio:** Antibiotici (crafting difficile + eventi città/villaggio)
- **Raro ma Accessibile:** Antidoti (crafting esistente + eventi città/foresta)

Ogni bioma contribuisce logicamente al reperimento delle cure:
- **Città:** Medicine moderne (Antibiotici, Antidoti, Kit medici)
- **Foresta:** Rimedi naturali (Erbe, Funghi medicinali)
- **Villaggio:** Mix di entrambi (Cliniche con medicine + Giardini con erbe)

### Impatto sul Gameplay

#### Prima della v1.3.2
- Status AVVELENATO: quasi impossibile da curare
- Status MALATO: curabili solo con antibiotici scaduti (rari)
- Status INFEZIONE: incurabili
- Morte frequente per status non gestibili
- Frustrazione da RNG negativa

#### Dopo la v1.3.2
- Ogni status ha almeno 2 vie di accesso alla cura (crafting + eventi)
- Le cure sono distribuite logicamente nei biomi appropriati
- Il crafting permette autosufficienza strategica
- La skill Medicina diventa più importante e utile
- Il giocatore ha controllo sulle proprie condizioni

### Risultato

Il gioco rimane estremamente difficile ma ora è giusto. La morte per status negativi è sempre conseguenza di decisioni sbagliate o mancanza di preparazione, mai di un'impossibilità sistemica. Il sistema di sopravvivenza è ora completo e bilanciato, con contromisure accessibili per ogni minaccia.

### Bug Fix Critico

Durante il testing della build è emerso un bug critico nel sistema di combattimento:

**Problema:** Crash al termine di un combattimento vittorioso con errore `ReferenceError: unlockedTalents is not defined`.

**Causa:** Nel file `store/combatStore.ts`, alla funzione `playerCombatAction`, il destructuring dello stato del personaggio non includeva le proprietà `unlockedTalents` e `addItem`, necessarie per:
- Verificare il talento Scavenger (2 roll di loot invece di 1)
- Aggiungere il loot dei nemici all'inventario

**Soluzione:** Aggiunte `unlockedTalents` e `addItem` al destructuring alla riga 116 del `combatStore.ts`.

**Impatto:** Il sistema di loot dai combattimenti (introdotto in v1.3.0) ora funziona correttamente senza crash.

### Note Tecniche

Tutti i file JSON sono stati validati e i nuovi oggetti sono compatibili con il sistema di effetti esistente. La retrocompatibilità con i salvataggi v1.3.x è garantita.

**File Modificati:**
- `public/data/items/consumables.json`
- `public/data/recipes.json`
- `public/data/events/city.json`
- `public/data/events/forest.json`
- `public/data/events/village.json`
- `store/combatStore.ts` (bug fix critico)
- `constants.ts` (versione aggiornata)
- `package.json` (versione aggiornata)
- `README.md` (documentazione aggiornata)
- `log/v1.3.2.md` (questo changelog)
- `log/versioning-sintesi.md` (aggiornato con v1.2.3-v1.3.2)

