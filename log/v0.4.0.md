# Log di Sviluppo - Versione 0.4.0

Questa versione consolida l'implementazione di due meccaniche di gioco fondamentali che trasformano il ciclo di gameplay da semplice esplorazione a una gestione strategica della sopravvivenza. Se la v0.3.0 ha stabilito le fondamenta degli oggetti, la v0.4.0 definisce come il giocatore interagisce con il mondo per recuperare le forze e trovare risorse, introducendo decisioni significative sulla gestione del tempo e del rischio.

Di seguito un'analisi dettagliata delle nuove funzionalità, ora parte integrante del nucleo del gioco.

### Dettagli dell'Implementazione

#### 1. Sistema Avanzato dei Rifugi (Hub Strategici)
I Rifugi (`R` sulla mappa) sono stati evoluti da semplici punti di interesse a veri e propri hub strategici con regole complesse.

- **Visita Unica:** La modifica più impattante. Ogni rifugio può essere visitato **una sola volta**. Una volta che il giocatore esce, non può più rientrare. Questa regola trasforma i rifugi in risorse preziose e limitate, la cui attivazione deve essere attentamente ponderata.
- **Menu Contestuale:** All'ingresso, il gioco si mette in pausa e presenta un menu di azioni specifiche, le cui opzioni variano in base all'ora del giorno e alle azioni già compiute.
- **Logica di Riposo Differenziata:**
  - **Riposo Diurno ("Aspetta un'ora"):** Disponibile di giorno, fa avanzare il tempo di 60 minuti e recupera una piccola quantità di HP (5). È uno strumento per la gestione del tempo.
  - **Riposo Notturno ("Dormi fino all'alba"):** Disponibile di notte, fa avanzare il tempo fino alle 06:00 del mattino successivo. Cura completamente gli HP, ma prima esegue un **controllo delle risorse**: se il personaggio non ha abbastanza sazietà e idratazione per sopravvivere al lungo riposo, l'azione fallisce.
- **Ricerca di Risorse ("Cerca nei dintorni"):**
  - **Test di Abilità (Skill Check):** L'azione innesca un test di **Percezione** contro una Classe di Difficoltà (CD) fissa (attualmente 10 per bilanciamento).
  - **Feedback Trasparente:** L'esito del test viene comunicato al giocatore sia nel diario di viaggio che in un messaggio temporaneo nella schermata del rifugio, mostrando i dettagli del tiro (`d20 + modificatore vs CD`).
  - **Costo e Rischio:** La ricerca consuma 30 minuti di tempo di gioco, indipendentemente dall'esito.
  - **Utilizzo Limitato:** La ricerca può essere tentata **una sola volta per visita**. Se ha successo, il rifugio si considera "saccheggiato" e l'opzione non sarà più disponibile in quel luogo.

#### 2. Meccanica di Riposo Rapido (Tasto 'R')
È stata introdotta una meccanica di riposo al di fuori dei rifugi, pensata come una risorsa strategica quotidiana.

- **Funzionamento:** Permette al giocatore di fermarsi in qualsiasi luogo sicuro per riposare.
- **Costo:** L'azione consuma 1 ora di tempo di gioco.
- **Beneficio:** Il personaggio recupera una quantità fissa di HP (20).
- **Cooldown Globale:** L'azione può essere eseguita solo **una volta ogni 24 ore di gioco**, costringendo il giocatore a decidere il momento migliore per usarla.

#### 3. Integrazione degli Skill Checks nel Gameplay
I test di abilità sono ora una parte attiva dell'esplorazione e dell'interazione con il mondo.

- **Attraversamento dell'Acqua:** Entrare in una casella d'acqua (`~`) richiede un test di **Atletica** per resistere alla corrente. Il fallimento comporta una piccola perdita di HP.
- **Ricerca nei Rifugi:** Come descritto sopra, la ricerca di oggetti è legata a un test di **Percezione**.

#### 4. Miglioramenti all'Immersione
- **Sistema di Biomi:** Il gioco ora riconosce il bioma in cui si trova il giocatore (Pianura, Foresta, Città, ecc.), mostrando un messaggio nel diario al primo ingresso.
- **Messaggi Atmosferici:** Durante l'esplorazione, compaiono occasionalmente messaggi descrittivi basati sul bioma, l'ora del giorno (giorno/notte) e le condizioni meteorologiche, arricchendo l'atmosfera del gioco.
- **Diario di Viaggio Avanzato:** Il diario ora include un timestamp per ogni evento e utilizza una codifica a colori per distinguere i tipi di messaggio (successo, fallimento, narrazione, ecc.), migliorandone notevolmente la leggibilità.

### Conclusione
Con la versione 0.4.0, "The Safe Place Chronicles" ha un ciclo di gameplay molto più ricco. Il giocatore non deve solo gestire le proprie risorse, ma anche il tempo e il rischio. I rifugi, da semplici punti di sosta, sono diventati decisioni cruciali e irripetibili. Queste meccaniche forniscono una solida base per l'introduzione di sistemi futuri come il combattimento e gli eventi narrativi.
