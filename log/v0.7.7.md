# Log di Sviluppo - Versione 0.7.7

Questa versione segna l'implementazione della meccanica più importante e ambiziosa del gioco: il framework concettuale per la **Missione Principale ("Main Quest")**. L'obiettivo era costruire un'architettura robusta e invisibile al giocatore, un "Motore della Storia" in grado di guidarlo attraverso una narrazione garantita e sequenziale, che si svela organicamente come conseguenza naturale del gameplay.

### Dettagli dell'Implementazione

#### 1. L'Architettura del "Motore della Storia"
È stata creata la spina dorsale tecnica per gestire la narrazione principale.

- **Tracciamento del Progresso:** Nello store di gioco (`gameStore.ts`) è stato introdotto un nuovo stato fondamentale: `mainQuestStage`. Questo valore numerico, che parte da 1, rappresenta il capitolo attuale della storia in cui si trova il giocatore.
- **Database della Storia:** È stato creato un nuovo sistema di caricamento dati per la quest (`data/mainQuestDatabase.ts`) che legge da `data/mainQuest.json`. Questo file fungerà da "biblioteca" per i dodici capitoli della storia, ognuno contenente titolo, testo e, soprattutto, la sua condizione di attivazione.
- **Stato di Gioco Dedicato:** È stato aggiunto un nuovo `GameState.MAIN_QUEST` per gestire i momenti in cui la narrazione interrompe il gioco.

#### 2. Il "Guardiano delle Soglie" (Sistema di Trigger)
Il cuore del sistema è una funzione di controllo invisibile che agisce come un "guardiano" narrativo.

- **Logica di Controllo Centralizzata:** È stata implementata la funzione `checkMainQuestTriggers` in `gameStore.ts`. Questa funzione viene invocata automaticamente dopo le azioni fondamentali del giocatore (muoversi, salire di livello, vincere un combattimento, sopravvivere a un nuovo giorno).
- **Funzionamento:** Ad ogni chiamata, il "guardiano" controlla lo `mainQuestStage` attuale del giocatore, legge dal database la condizione per sbloccare il capitolo successivo e la confronta con lo stato attuale del personaggio e del mondo.

#### 3. Condizioni di Attivazione Flessibili
Per garantire che la storia progredisca in modo organico, sono stati implementati diversi tipi di "chiavi" narrative.

- **Tracciamento delle Statistiche Chiave:** Sono stati aggiunti nuovi contatori nello stato di gioco, come `totalSteps` e `totalCombatWins`, per monitorare le azioni del giocatore nel tempo.
- **Tipologie di Trigger:** In `types.ts` è stato definito un sistema di trigger flessibile (`QuestTrigger`) che permette di legare l'avanzamento della storia a:
  - **Soglie di Esplorazione:** `stepsTaken` (passi totali compiuti).
  - **Soglie Temporali:** `daysSurvived` (giorni sopravvissuti).
  - **Soglie di Esperienza:** `levelReached` (livello raggiunto), `combatWins` (combattimenti vinti).
  - **Soglie Contestuali:** `firstRefugeEntry` (prima volta che si entra in un rifugio).

#### 4. L'Esperienza Narrativa (Interfaccia Dedicata)
Quando una condizione di attivazione viene soddisfatta, l'esperienza del giocatore è gestita da una nuova interfaccia.

- **Interruzione del Gameplay:** Se un trigger viene attivato, il gioco passa allo stato `GameState.MAIN_QUEST`.
- **Schermata Narrativa Immersiva:** Viene renderizzato il nuovo componente `MainQuestScreen.tsx`. Questa è una schermata a schermo intero, con uno stile distinto, che mostra il titolo e il testo del capitolo della storia, presentandolo come un ricordo o una rivelazione.
- **Interazione Minimale:** L'unica interazione richiesta al giocatore è premere `Invio` per [Continuare], assicurando che l'attenzione sia focalizzata al 100% sulla narrazione. Una volta fatto, il gioco torna allo stato `IN_GAME`.

### Conclusione
Con la versione 0.7.7, "The Safe Place Chronicles" ha ora un solido e scalabile "Filo di Arianna" narrativo. Il framework implementato garantisce una progressione della storia principale che è allo stesso tempo inevitabile e perfettamente integrata nel flusso di gioco, trasformando la sopravvivenza in un viaggio con uno scopo. Il sistema è ora pronto per essere popolato con i contenuti effettivi dei dodici capitoli della storia.