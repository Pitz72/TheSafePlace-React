# Log di Sviluppo - Versione 1.3.1

Questa versione rappresenta una revisione fondamentale dei sistemi di sopravvivenza del gioco, risolvendo problematiche strutturali di game design che rendevano l'esperienza di gioco eccessivamente dipendente dalla casualità. L'obiettivo è stato trasformare la sopravvivenza da un sistema passivo basato sulla fortuna a un sistema proattivo basato sulle decisioni strategiche del giocatore.

### Analisi del Problema

Attraverso il testing estensivo e il feedback diretto dei giocatori è emerso che quattro aspetti fondamentali del gameplay risultavano problematici:

1. **Sistema Acqua:** La risorsa più critica era quasi introvabile. Solo circa il 11% degli eventi offriva acqua, spesso condizionata da test di abilità. Non esistevano fonti rinnovabili o controllabili dal giocatore.

2. **Accessibilità del Crafting:** Il sistema di crafting era inaccessibile. Le ricette si apprendevano esclusivamente da manuali estremamente rari (circa 3% di probabilità), trasformando una meccanica core in un bonus casuale.

3. **Passività del Giocatore:** Non esistevano azioni proattive per cercare risorse. Il giocatore era completamente passivo, affidandosi esclusivamente a eventi casuali e rifugi.

4. **Combattimenti Punitivi:** I nemici sconfitti fornivano solo punti esperienza, nessun materiale o consumabile. Il rischio era alto ma la ricompensa materiale inesistente, rendendo la fuga sempre la scelta ottimale.

### Soluzioni Implementate

#### 1. Sistema di Purificazione dell'Acqua

È stato implementato un ciclo completo di gestione dell'acqua attraverso nuove ricette e materiali:

**Nuovi Materiali (4):**
- `dirty_water` - Acqua Contaminata: Comune in tutti i biomi, richiede purificazione
- `bottle_empty` - Bottiglia Vuota: Contenitore riutilizzabile per raccolta acqua
- `clean_cloth` - Straccio Pulito: Materiale base per filtri e bende
- `adhesive_tape` - Nastro Adesivo: Materiale generico per crafting e riparazioni

**Nuove Ricette (3):**
- `recipe_purify_water` - Purifica Acqua (Sopravvivenza CD 8, 10 minuti): Converte acqua contaminata in acqua potabile usando straccio pulito come filtro
- `recipe_makeshift_bandage` - Benda di Fortuna (Sopravvivenza CD 6, 5 minuti): Produce 2 bende base da 1 straccio pulito
- `recipe_collect_water` - Raccogli Acqua (Sopravvivenza CD 5, 5 minuti): Usa bottiglia vuota per raccogliere 2 unità di acqua contaminata

Questo sistema crea un ciclo di gioco sostenibile: il giocatore trova bottiglie vuote, raccoglie acqua contaminata, la purifica con stracci, e ottiene acqua potabile. Ogni passaggio richiede risorse e tempo, bilanciando accessibilità e sfida.

#### 2. Sistema di Ricerca Attiva

È stata implementata una nuova meccanica core che permette al giocatore di cercare proattivamente risorse nell'ambiente circostante.

**Meccanica:**
- Keybinding: Tasto F
- Costo temporale: 30 minuti di gioco
- Test abilità: Sopravvivenza CD 10
- Blocchi: Non funziona in acqua o nei rifugi
- Cooldown: Una ricerca per bioma (reset quando si entra in un nuovo bioma)

**Loot Tables per Bioma:**

Pianura (focalizzata su acqua e cibo):
- Acqua Contaminata (30%, quantità 2-3)
- Bacche Selvatiche (25%, quantità 2-3)
- Bottiglie Vuote (15%, quantità 1)
- Stracci Puliti (10%, quantità 1)
- Legna da Ardere (10%, quantità 2-3)
- Pelle Animale (10%, quantità 1)

Foresta (focalizzata su legna e risorse naturali):
- Legna da Ardere (35%, quantità 3-4)
- Funghi Commestibili (20%, quantità 2-3)
- Bacche Selvatiche (15%, quantità 2-3)
- Pelle Animale (15%, quantità 1)
- Acqua Contaminata (10%, quantità 2)
- Stracci Puliti (5%, quantità 1)

Città (focalizzata su materiali tecnologici):
- Metallo di Scarto (30%, quantità 2-4)
- Bottiglie Vuote (25%, quantità 2-3)
- Stracci Puliti (15%, quantità 1-2)
- Nastro Adesivo (10%, quantità 1)
- Pezzetti di Metallo (10%, quantità 2-4)
- Filo di Nylon (5%, quantità 1)
- Componenti Tecnologici (5%, quantità 1)

Villaggio (focalizzato su cibo e materiali base):
- Stracci Puliti (25%, quantità 2-3)
- Bottiglie Vuote (20%, quantità 1-2)
- Carote (15%, quantità 2-3)
- Patate (15%, quantità 2-3)
- Acqua Contaminata (10%, quantità 2)
- Attrezzi da Giardino (10%, quantità 1)
- Scatola Chiodi (5%, quantità 1)

Bonus Speciale - Tile Fiume:
Quando si usa Ricerca Attiva su una tile contrassegnata con 'R' (fiume), il giocatore riceve automaticamente 3-4 unità di acqua contaminata e recupera immediatamente 10 punti idratazione. Questo trasforma i fiumi in punti strategici sulla mappa.

Il talento Scavenger raddoppia o triplica le quantità ottenute, rendendolo significativamente più prezioso.

#### 3. Sistema di Loot dai Nemici

I combattimenti ora forniscono ricompense materiali oltre ai punti esperienza. Il sistema è stratificato in tre tier basati sul valore XP del nemico:

**Common Enemies (XP inferiore a 80):**
- Metallo di Scarto (30%, quantità 1-3)
- Stracci Puliti (25%, quantità 1-2)
- Benda di Fortuna (20%, quantità 1-2)
- Bottiglia Vuota (15%, quantità 1-2)
- Razione Cibo (10%, quantità 1)

**Uncommon Enemies (XP 80-119):**
- Pelle Animale (25%, quantità 1-2)
- Metallo di Scarto (20%, quantità 2-4)
- Bende (15%, quantità 1-2)
- Stoffa Resistente (15%, quantità 1-2)
- Bottiglia Acqua (10%, quantità 1)
- Nastro Adesivo (10%, quantità 1)
- Disinfettante (5%, quantità 1)

**Rare Enemies (XP 120+):**
- Metallo Alta Qualità (20%, quantità 1-2)
- Pelle Animale (20%, quantità 2-3)
- Kit Pronto Soccorso (15%, quantità 1)
- Bende (15%, quantità 2-3)
- Disinfettante (10%, quantità 1-2)
- Componenti Tecnologici (10%, quantità 1)
- Antidolorifico (10%, quantità 1)

Il giocatore riceve normalmente 1 oggetto per vittoria. Il talento Scavenger garantisce 2 roll invece di 1, raddoppiando le ricompense potenziali.

#### 4. Starter Kit Completo

L'inventario iniziale è stato rivisto per fornire al giocatore gli strumenti base necessari fin dall'inizio:

**Inventario Iniziale (da 3 a 10 items):**
- 1x Carillon Annerito (oggetto quest)
- 2x Razione Cibo
- 2x Bottiglia Acqua
- 3x Benda di Fortuna
- 3x Metallo di Scarto
- 3x Straccio Pulito
- 2x Bottiglia Vuota

**Ricette Iniziali Conosciute (da 3 a 5):**
- recipe_purify_water (nuova)
- recipe_makeshift_bandage (nuova)
- recipe_collect_water (nuova)
- recipe_makeshift_knife (esistente)
- recipe_repair_kit_basic (esistente)

Questo kit fornisce al giocatore tutto il necessario per sopravvivere i primi giorni e apprendere i sistemi base del gioco senza dipendere dalla fortuna.

#### 5. Espansione Loot Table Rifugi

Il loot table dei rifugi è stato ampliato da 10 a 15 oggetti unici, con una distribuzione più bilanciata:

**Distribuzione per Categoria:**
- Acqua e Cibo (35%): Acqua pulita, acqua contaminata, cibo
- Forniture Mediche (15%): Bende varie, disinfettante
- Materiali Crafting (25%): Metallo, stracci, bottiglie, nastro, stoffa
- Manuali (20%): 4 manuali diversi
- Consumabili Avanzati (5%): Antidolorifici, kit pronto soccorso

Il talento Scavenger aumenta le quantità ottenute del 50-200% a seconda dell'oggetto.

### Correzioni Tecniche

Durante l'implementazione sono emersi e risolti diversi bug critici:

1. **Mancanza UI Comando F:** Il keybinding F non era documentato nel pannello comandi. Aggiunto visivamente accanto agli altri comandi.

2. **Assenza Cooldown Ricerca:** Il sistema di Ricerca Attiva inizialmente poteva essere spammato. Implementato sistema di cooldown per bioma tramite variabile di stato `lastSearchedBiome`.

3. **Loot Non Assegnato:** In alcuni casi il test Sopravvivenza veniva superato ma nessun oggetto veniva aggiunto all'inventario. Causa: condizione che verificava esistenza item nel database prima di chiamare `addItem()`. Risolto rimuovendo il check condizionale.

4. **Sincronizzazione File Public:** I file JSON modificati in `data/` non erano stati copiati in `public/data/`, causando il caricamento di dati obsoleti in modalità sviluppo. Implementato processo di sincronizzazione manuale. Questo bug causava la visualizzazione di sole 2 ricette invece di 5 e l'impossibilità di trovare i nuovi materiali.

### Impatto sul Gameplay

Questa revisione trasforma radicalmente l'esperienza di gioco:

**Prima della v1.3.1:**
- Sopravvivenza dipendente al 90% dalla fortuna
- Morte per sete quasi inevitabile in run lunghe
- Crafting inaccessibile per la maggior parte del gioco
- Combattimenti sempre svantaggiosi
- Giocatore completamente passivo

**Dopo la v1.3.1:**
- Sopravvivenza basata su decisioni strategiche
- Ogni risorsa critica ha almeno 2 modi per ottenerla
- Crafting accessibile dall'inizio con progressione organica
- Combattimenti con rapporto rischio/ricompensa bilanciato
- Giocatore proattivo con controllo sulla propria sopravvivenza

Il gioco rimane molto difficile ma la difficoltà è ora legittima: ogni morte è conseguenza di una decisione sbagliata, non di casualità pura.

### File Modificati

**Core System (3 file):**
- `constants.ts` - Versione aggiornata a 1.3.1
- `package.json` - Versione aggiornata a 1.3.1
- `types.ts` - Aggiunto campo `lastSearchedBiome` a GameStoreState, aggiunto metodo `performActiveSearch()`

**Game Logic (4 file):**
- `store/gameStore.ts` - Implementata funzione `performActiveSearch()` (150 righe), aggiunto sistema cooldown bioma
- `store/characterStore.ts` - Inventario iniziale espanso (3→10 items), ricette iniziali aumentate (3→5)
- `store/combatStore.ts` - Implementato sistema loot nemici (70 righe) con 3 tier
- `store/interactionStore.ts` - Loot table rifugi espansa (10→15 items)

**UI Components (1 file):**
- `components/GameScreen.tsx` - Aggiunto keybinding F, handler `handleActiveSearch()`, aggiornato pannello comandi

**Data Files (2 file):**
- `data/items/materials.json` - Aggiunti 4 nuovi materiali
- `data/recipes.json` - Aggiunte 3 nuove ricette all'inizio del file
- `public/data/items/materials.json` - Sincronizzato con data/
- `public/data/recipes.json` - Sincronizzato con data/

**Totale Modifiche:**
- 13 file modificati
- Circa 350 righe di codice aggiunte
- 50 righe modificate
- 4 nuovi assets (items)
- 3 nuove ricette
- 1 nuova meccanica core
- 7 loot tables implementate

### Compatibilità

La versione 1.3.1 è completamente retrocompatibile con i salvataggi v1.2.4. Tuttavia, i salvataggi vecchi mantengono solo 3 ricette iniziali invece di 5. Si consiglia di iniziare una nuova partita per sfruttare completamente le nuove meccaniche.

### Testing e Stabilità

Sono stati condotti test estensivi sui seguenti scenari:
- Ciclo completo acqua (raccolta → purificazione → consumo)
- Sistema ricerca attiva in tutti e 4 i biomi
- Cooldown ricerca per bioma
- Loot nemici per tutti e 3 i tier
- Crafting con nuove ricette
- Compatibilità salvataggi vecchi
- Performance generale

Build di produzione completata senza errori. Zero errori di linting. Tutti i sistemi verificati funzionanti.
